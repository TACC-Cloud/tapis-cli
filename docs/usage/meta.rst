########
Metadata
########

Support for the legacy Tapis meta service is provided by the **meta**
command set. New, and of note, is support for directly storing and
retrieving values using the metadata service, making its usage modality more
like that of a key-value store. See usage examples below:

****************
General Commands
****************

.. autoprogram-cliff:: tapis.cli
   :command: meta create

.. autoprogram-cliff:: tapis.cli
   :command: meta update

.. autoprogram-cliff:: tapis.cli
   :command: meta list

.. autoprogram-cliff:: tapis.cli
   :command: meta show

.. autoprogram-cliff:: tapis.cli
   :command: meta delete

****************
Sharing Commands
****************

.. autoprogram-cliff:: tapis.cli
   :command: meta pems *

***************
Search Commands
***************

It is possible to search for tapis Metadata by several criteria. Please consult
``tapis meta search -h`` for guidance.

**************
Usage Examples
**************

Metadata records have historically been written in Tapis by specifying a
complete, schema-compliant JSON document. This has been considered by some
users to be burdensome, so the CLI simplifies these operations. A JSON file
can be specified, but it is also possible to specify ``-name`` and ``--value``
or even just a ``--value``.

Example 1
---------

.. code-block:: shell

    # Store a simple value
    #
    # --name is not provided, causing one to be autogenerated

    $ tapis meta create --value "This is a test"
    +-------------+----------------------------------------+
    | Field       | Value                                  |
    +-------------+----------------------------------------+
    | uuid        | 7811051068989444586-242ac11a-0001-012  |
    | owner       | vaughn                                 |
    | name        | vaughn.f16204ef7ed05949.191107T183550Z |
    | value       | This is a test                         |
    | created     | just now                               |
    | lastUpdated | just now                               |
    +-------------+----------------------------------------+

    # Search by the document's name
    $ tapis meta search --name eq vaughn.f16204ef7ed05949.191107T183550Z
    +---------------------------------------+--------+----------------------------------------+
    | uuid                                  | owner  | name                                   |
    +---------------------------------------+--------+----------------------------------------+
    | 7811051068989444586-242ac11a-0001-012 | vaughn | vaughn.f16204ef7ed05949.191107T183550Z |
    +---------------------------------------+--------+----------------------------------------+

    # Display the document using its UUID
    $ tapis meta show 7811051068989444586-242ac11a-0001-012
    +-------------+----------------------------------------+
    | Field       | Value                                  |
    +-------------+----------------------------------------+
    | uuid        | 7811051068989444586-242ac11a-0001-012  |
    | owner       | vaughn                                 |
    | name        | vaughn.f16204ef7ed05949.191107T183550Z |
    | value       | This is a test                         |
    | created     | 2 minutes ago                          |
    | lastUpdated | 2 minutes ago                          |
    +-------------+----------------------------------------+

    # Update a document's value.
    # (Note that the name doesn't change)
    $ tapis meta update -V "This value was changed" 1111886352317476375-242ac11a-0001-012
    +-------------+----------------------------------------+
    | Field       | Value                                  |
    +-------------+----------------------------------------+
    | uuid        | 7811051068989444586-242ac11a-0001-012  |
    | owner       | vaughn                                 |
    | name        | vaughn.f16204ef7ed05949.191107T183550Z |
    | value       | This value was changed                 |
    | created     | 3 minutes ago                          |
    | lastUpdated | just now                               |
    +-------------+----------------------------------------+

Example 2
---------

.. code-block:: shell

    # Store a value with a defined name
    $ tapis meta create --value "Another test" --name "key_name_101"
    +-------------+---------------------------------------+
    | Field       | Value                                 |
    +-------------+---------------------------------------+
    | uuid        | 8195591104591958506-242ac11a-0001-012 |
    | owner       | vaughn                                |
    | name        | key_name_101                          |
    | value       | Another test                          |
    | created     | just now                              |
    | lastUpdated | just now                              |
    +-------------+---------------------------------------+

    # Rename the record
    $ tapis meta update --name "renamed_key_101" 8195591104591958506-242ac11a-0001-012
    +-------------+---------------------------------------+
    | Field       | Value                                 |
    +-------------+---------------------------------------+
    | uuid        | 8195591104591958506-242ac11a-0001-012 |
    | owner       | vaughn                                |
    | name        | renamed_key_101                       |
    | value       | Another test                          |
    | created     | 2 minutes ago                         |
    | lastUpdated | just now                              |
    +-------------+---------------------------------------+

    # Delete the record
    $ tapis meta delete 8195591104591958506-242ac11a-0001-012
    +----------+-------+
    | Field    | Value |
    +----------+-------+
    | deleted  | 1     |
    | messages | 0     |
    +----------+-------+

Example 3
---------

.. code-block:: shell

    # Display the full JSON API response, including the document
    $ tapis meta show -v 4405227902607364586-242ac11a-0001-012
    {
    "uuid": "4405227902607364586-242ac11a-0001-012",
    "schemaId": null,
    "internalUsername": null,
    "owner": "vaughn",
    "associationIds": [],
    "name": "vaughn.f16204ef7ed05949.191107T183431Z",
    "value": "This is a test",
    "created": "2019-11-07T12:34:31.591-06:00",
    "lastUpdated": "2019-11-07T12:34:31.591-06:00",
    "_links": {
        "self": {
        "href": "https://api.tacc.utexas.edu/meta/v2/data/4405227902607364586-242ac11a-0001-012"
        },
        "permissions": {
        "href": "https://api.tacc.utexas.edu/meta/v2/data/4405227902607364586-242ac11a-0001-012/pems"
        },
        "owner": {
        "href": "https://api.tacc.utexas.edu/profiles/v2/vaughn"
        },
        "associationIds": []
    }
    }

